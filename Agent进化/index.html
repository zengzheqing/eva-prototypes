<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EVA · Agent进化（原型 v1）</title>

    <!--
    ============================================================
    EVA 原型模板 v1.1（Agent进化模块）
    ============================================================
    设计规范: ../EVA-Design-System.md (第10节)
    参考原型: ../题库/题库-原型-v2-题目管理视角.html（复用设计系统与布局）
    产品规格: Agent进化-产品规格.md

    @FROZEN 区域说明:
    - 设计系统核心样式: CSS变量、重置、通用组件
    - 画板模式核心架构: 模式切换、画板容器、画板样式
    - 核心JavaScript: 模式切换、截图、打印功能

    AI 可修改区域:
    - 模块特有样式（标记为 TODO）
    - 交互模式的实际内容（手风琴、弹窗、进化动效、画板内容）
    ============================================================
    -->

    <!-- ========== @FROZEN: 设计系统核心样式 ========== -->
    <!-- ========== 内联样式 (生成于 2026-02-03 16:28) ========== -->
<style>
/* ========== eva-base.css ========== */
/**
 * EVA Design System - Base Styles
 * Version: 2.0
 *
 * 使用说明: 在 HTML 的 <head> 中引用
 * <link rel="stylesheet" href="eva-base.css">
 *
 * 规范文档: EVA-Design-System.md
 * 视觉参考: eva-enterprise-onboarding (Google AI Studio)
 */

/* ========== @FROZEN: 色彩系统 ========== */
/* 说明: 所有颜色值遵循 EVA-Design-System.md */
:root {
    /* 背景色 */
    --bg: #f8fafc;
    --bg-elevated: #ffffff;
    --bg-subtle: #f1f5f9;

    /* 文字色 */
    --text: #0f172a;
    --text-secondary: #64748b;
    --text-muted: #94a3b8;

    /* 主色调 */
    --accent: #6366f1;
    --accent-dark: #4f46e5;
    --accent-light: #e0e7ff;
    --accent-glow: rgba(99, 102, 241, 0.15);
    --accent-hover: #4f46e5;

    /* 功能色 */
    --success: #10b981;
    --success-light: #ecfdf5;
    --warning: #f59e0b;
    --warning-light: #fffbeb;
    --danger: #ef4444;
    --danger-light: #fef2f2;

    /* 边框色 */
    --border: #e2e8f0;
    --border-subtle: #f1f5f9;

    /* 阴影 - 升级版 */
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
    --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    --shadow-accent: 0 10px 40px -10px rgba(99, 102, 241, 0.3);
    --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05);

    /* 圆角 - 升级版（更大更现代） */
    --radius-sm: 12px;
    --radius: 16px;
    --radius-lg: 24px;
    --radius-xl: 32px;
    --radius-2xl: 40px;
    --radius-3xl: 48px;
    --radius-full: 9999px;

    /* 间距系统 */
    --space-1: 4px;
    --space-2: 8px;
    --space-3: 12px;
    --space-4: 16px;
    --space-5: 20px;
    --space-6: 24px;
    --space-8: 32px;
    --space-10: 40px;
    --space-12: 48px;
    --space-16: 64px;

    /* 过渡时间 */
    --duration-fast: 0.15s;
    --duration: 0.3s;
    --duration-slow: 0.5s;
    --duration-slower: 0.7s;
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 全局重置 ========== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 排版系统 ========== */
.title {
    font-size: 32px;
    font-weight: 700;
    color: var(--text);
    line-height: 1.2;
    margin-bottom: 12px;
    letter-spacing: -0.025em;
}

.title-xl {
    font-size: 40px;
    font-weight: 900;
    color: var(--text);
    line-height: 1.1;
    letter-spacing: -0.03em;
}

.subtitle {
    font-size: 16px;
    color: var(--text-secondary);
    line-height: 1.7;
    margin-bottom: 40px;
}

.label {
    display: block;
    font-size: 11px;
    font-weight: 700;
    color: var(--text-secondary);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

/* 字体工具类 */
.font-black {
    font-weight: 900;
}

.font-bold {
    font-weight: 700;
}

.font-semibold {
    font-weight: 600;
}

.font-medium {
    font-weight: 500;
}

.tracking-tighter {
    letter-spacing: -0.05em;
}

.tracking-tight {
    letter-spacing: -0.025em;
}

.tracking-normal {
    letter-spacing: 0;
}

.tracking-wide {
    letter-spacing: 0.025em;
}

.tracking-wider {
    letter-spacing: 0.05em;
}

.tracking-widest {
    letter-spacing: 0.1em;
}

.uppercase {
    text-transform: uppercase;
}

.capitalize {
    text-transform: capitalize;
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 按钮系统 ========== */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 18px 40px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: var(--radius-xl);
    font-weight: 700;
    cursor: pointer;
    font-size: 16px;
    letter-spacing: -0.01em;
    transition: all var(--duration);
    text-decoration: none;
}

.btn:hover {
    background: var(--accent-hover);
    transform: translateY(-2px) scale(1.02);
    box-shadow: var(--shadow-accent);
}

.btn:active {
    transform: translateY(0) scale(0.98);
}

.btn-lg {
    padding: 22px 48px;
    font-size: 18px;
    font-weight: 900;
    border-radius: var(--radius-2xl);
}

.btn-secondary {
    background: transparent;
    color: var(--text);
    border: 2px solid var(--border);
}

.btn-secondary:hover {
    background: var(--bg-subtle);
    border-color: var(--accent);
    box-shadow: none;
}

.btn-ghost {
    background: transparent;
    color: var(--text-secondary);
    padding: 10px 20px;
}

.btn-ghost:hover {
    color: var(--accent);
    background: var(--accent-light);
    box-shadow: none;
    transform: none;
}

.btn-sm {
    padding: 12px 24px;
    font-size: 13px;
    font-weight: 600;
}

.btn-full {
    width: 100%;
}

.btn-dark {
    background: var(--text);
    color: white;
}

.btn-dark:hover {
    background: #1e293b;
    box-shadow: var(--shadow-lg);
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 输入框系统 ========== */
.input-box {
    margin-bottom: 28px;
}

.input {
    width: 100%;
    padding: 18px 20px;
    border: 2px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    font-size: 16px;
    outline: none;
    transition: all var(--duration);
    background: var(--bg);
    color: var(--text);
}

.input::placeholder {
    color: var(--text-muted);
}

.input:focus {
    background: white;
    border-color: var(--accent);
    box-shadow: 0 0 0 4px var(--accent-light);
}

.input:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

textarea.input {
    min-height: 120px;
    resize: vertical;
}

.input-lg {
    padding: 20px 24px;
    font-size: 18px;
    border-radius: var(--radius-xl);
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 卡片系统 ========== */
.card {
    background: var(--bg-elevated);
    padding: 32px;
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-card);
    border: 2px solid transparent;
    transition: all var(--duration-slow);
    position: relative;
    overflow: hidden;
}

.card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.card.active {
    border-color: var(--success);
    transform: translateY(-4px) scale(1.02);
    box-shadow: var(--shadow-lg);
}

.card.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--success);
}

.card.dim {
    opacity: 0.5;
    transform: scale(0.98);
    filter: grayscale(0.3);
}

.card-lg {
    padding: 40px;
    border-radius: var(--radius-3xl);
}

.card-interactive {
    cursor: pointer;
}

.card-interactive:hover {
    border-color: var(--accent);
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 标签/徽章系统 ========== */
.tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 12px;
    padding: 4px 10px;
    border-radius: 6px;
    background: var(--bg-subtle);
    color: var(--text-secondary);
    border: 1px solid var(--border);
}

.tag.core {
    background: #eef2ff;
    color: var(--accent);
    border-color: #c7d2fe;
    font-weight: 600;
}

.badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 11px;
    font-weight: 500;
    padding: 2px 8px;
    border-radius: 20px;
}

.badge.success {
    background: rgba(16, 185, 129, 0.15);
    color: var(--success);
}

.badge.warning {
    background: rgba(245, 158, 11, 0.15);
    color: var(--warning);
}

.badge.danger {
    background: rgba(239, 68, 68, 0.15);
    color: var(--danger);
}

.badge.info {
    background: var(--accent-light);
    color: var(--accent);
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 进度指示器 ========== */
.stepper {
    display: flex;
    gap: 8px;
    margin-bottom: 40px;
}

.step-dot {
    width: 32px;
    height: 6px;
    background: var(--border);
    border-radius: 3px;
    transition: all var(--duration);
}

.step-dot.active {
    background: var(--accent);
    width: 48px;
}

.step-dot.done {
    background: var(--success);
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 图标容器 ========== */
.icon-box {
    width: 48px;
    height: 48px;
    background: var(--bg-subtle);
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    transition: all var(--duration);
}

.icon-box.active {
    background: var(--success-light);
    color: var(--success);
}

.icon-box.accent {
    background: var(--accent-light);
    color: var(--accent);
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 网格系统 ========== */
.grid {
    display: grid;
    gap: 20px;
}

.grid-2 {
    grid-template-columns: repeat(2, 1fr);
}

.grid-3 {
    grid-template-columns: repeat(3, 1fr);
}

.grid-4 {
    grid-template-columns: repeat(4, 1fr);
}

.grid-12 {
    grid-template-columns: repeat(12, 1fr);
}

.col-2 {
    grid-column: span 2;
}

.col-3 {
    grid-column: span 3;
}

.col-4 {
    grid-column: span 4;
}

.col-6 {
    grid-column: span 6;
}

.col-8 {
    grid-column: span 8;
}

.col-12 {
    grid-column: span 12;
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 工具类 ========== */
/* Flex */
.flex {
    display: flex;
}

.flex-col {
    flex-direction: column;
}

.items-center {
    align-items: center;
}

.justify-center {
    justify-content: center;
}

.justify-between {
    justify-content: space-between;
}

.gap-sm {
    gap: 8px;
}

.gap-md {
    gap: 16px;
}

.gap-lg {
    gap: 24px;
}

/* Spacing */
.mt-sm {
    margin-top: 8px;
}

.mt-md {
    margin-top: 16px;
}

.mt-lg {
    margin-top: 24px;
}

.mt-xl {
    margin-top: 32px;
}

.mb-sm {
    margin-bottom: 8px;
}

.mb-md {
    margin-bottom: 16px;
}

.mb-lg {
    margin-bottom: 24px;
}

.mb-xl {
    margin-bottom: 32px;
}

/* Text */
.text-center {
    text-align: center;
}

.text-muted {
    color: var(--text-muted);
}

.text-secondary {
    color: var(--text-secondary);
}

.text-accent {
    color: var(--accent);
}

.text-success {
    color: var(--success);
}

.font-bold {
    font-weight: 600;
}

/* Display */
.hidden {
    display: none;
}

.block {
    display: block;
}

/* ========== @END-FROZEN ========== */


/* ========== @STABLE: 页面切换 ========== */
/* 说明: 可以调整动画参数，但不要删除 */
.page {
    display: none;
}

.page.active {
    display: flex;
}

/* ========== @END-STABLE ========== */

/* ========== eva-animations.css ========== */
/**
 * EVA Design System - Animations
 * Version: 2.0
 *
 * 使用说明: 在 HTML 的 <head> 中引用（在 eva-base.css 之后）
 * <link rel="stylesheet" href="eva-animations.css">
 *
 * 来源: 深色版的优秀视觉效果 + 白色版的轨道动画 + Google AI Studio 版本动效
 */

/* ========== @FROZEN: 环境动画背景 (来源: 深色版) ========== */
/* 说明: 已适配浅色主题，创造柔和的动态背景效果 */
.ambient {
    position: fixed;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
    z-index: 0;
}

.ambient::before {
    content: '';
    position: absolute;
    width: 800px;
    height: 800px;
    background: radial-gradient(circle, rgba(99, 102, 241, 0.08), transparent 65%);
    top: -20%;
    left: -15%;
    animation: drift1 40s ease-in-out infinite;
}

.ambient::after {
    content: '';
    position: absolute;
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, rgba(236, 72, 153, 0.05), transparent 65%);
    bottom: -15%;
    right: -10%;
    animation: drift2 35s ease-in-out infinite;
}

/* 环境圆（白色版原有的，保留兼容） */
.ambient-circle {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.6;
    z-index: 0;
}

.ac-1 {
    width: 600px;
    height: 600px;
    background: rgba(99, 102, 241, 0.08);
    top: -10%;
    right: 10%;
}

.ac-2 {
    width: 500px;
    height: 500px;
    background: rgba(236, 72, 153, 0.05);
    bottom: -10%;
    left: 20%;
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 漂移动画关键帧 ========== */
@keyframes drift1 {

    0%,
    100% {
        transform: translate(0, 0);
    }

    50% {
        transform: translate(50px, 50px);
    }
}

@keyframes drift2 {

    0%,
    100% {
        transform: translate(0, 0);
    }

    50% {
        transform: translate(-30px, -30px);
    }
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 轨道动画 (来源: 白色版) ========== */
/* 说明: 用于 Hero 区域的装饰性动画 */
.hero-illustration {
    position: relative;
    width: 500px;
    height: 500px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.orbit {
    position: absolute;
    border: 1px dashed #cbd5e1;
    border-radius: 50%;
}

.o1 {
    width: 280px;
    height: 280px;
    animation: spin 20s linear infinite;
}

.o2 {
    width: 460px;
    height: 460px;
    animation: spin 30s linear infinite reverse;
}

.agent-center {
    width: 140px;
    height: 140px;
    background: white;
    border-radius: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 60px;
    box-shadow: 0 20px 60px rgba(99, 102, 241, 0.15);
    z-index: 2;
}

.orbit-item {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 40px;
    height: 40px;
    background: white;
    border-radius: 10px;
    box-shadow: var(--shadow-card, 0 4px 6px -1px rgba(0, 0, 0, 0.05));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 通用动画关键帧 ========== */
/* 旋转 */
@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* 淡入 */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* 淡入（无位移） */
@keyframes fadeInSimple {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* 脉冲 */
@keyframes pulse {

    0%,
    100% {
        opacity: 1;
    }

    50% {
        opacity: 0.5;
    }
}

/* 弹跳 */
@keyframes bounce {

    0%,
    100% {
        transform: translateY(0);
    }

    50% {
        transform: translateY(-10px);
    }
}

/* 缩放脉冲 */
@keyframes scalePulse {

    0%,
    100% {
        transform: scale(1);
    }

    50% {
        transform: scale(1.05);
    }
}

/* 闪烁 */
@keyframes blink {

    0%,
    100% {
        opacity: 1;
    }

    50% {
        opacity: 0;
    }
}

/* 滑入（从右） */
@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(20px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* 滑入（从左） */
@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 动画工具类 ========== */
/* 基础淡入 */
.fade-in {
    animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.fade-in-fast {
    animation: fadeIn 0.3s ease forwards;
}

.fade-in-slow {
    animation: fadeIn 1s ease forwards;
}

/* 脉冲 */
.pulse {
    animation: pulse 2s infinite;
}

/* 旋转 */
.spin {
    animation: spin 1s linear infinite;
}

.spin-slow {
    animation: spin 3s linear infinite;
}

/* 弹跳 */
.bounce {
    animation: bounce 2s ease-in-out infinite;
}

/* 滑入 */
.slide-in-right {
    animation: slideInRight 0.4s ease forwards;
}

.slide-in-left {
    animation: slideInLeft 0.4s ease forwards;
}

/* ========== @END-FROZEN ========== */


/* ========== @FROZEN: 加载指示器 ========== */
.loader {
    width: 20px;
    height: 20px;
    border: 2px solid var(--accent, #6366f1);
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

.loader-sm {
    width: 14px;
    height: 14px;
    border-width: 1.5px;
}

.loader-lg {
    width: 32px;
    height: 32px;
    border-width: 3px;
}

/* 状态监视器 */
.status-monitor {
    background: white;
    border-radius: 16px;
    padding: 16px 24px;
    box-shadow: var(--shadow-lg, 0 20px 25px -5px rgba(0, 0, 0, 0.1));
    display: flex;
    align-items: center;
    gap: 16px;
    border: 1px solid var(--border, #e2e8f0);
}

/* ========== @END-FROZEN ========== */


/* ========== @STABLE: 延迟动画 ========== */
/* 说明: 用于序列化动画效果，可根据需要调整延迟值 */
.delay-100 {
    animation-delay: 0.1s;
}

.delay-200 {
    animation-delay: 0.2s;
}

.delay-300 {
    animation-delay: 0.3s;
}

.delay-400 {
    animation-delay: 0.4s;
}

.delay-500 {
    animation-delay: 0.5s;
}

.delay-600 {
    animation-delay: 0.6s;
}

.delay-700 {
    animation-delay: 0.7s;
}

.delay-800 {
    animation-delay: 0.8s;
}

.delay-900 {
    animation-delay: 0.9s;
}

.delay-1000 {
    animation-delay: 1s;
}

/* ========== @END-STABLE ========== */


/* ========== @STABLE: 高级动画 (来源: Google AI Studio) ========== */
/* 滑入淡出 - 从底部 */
@keyframes slideInFromBottom {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* 缩放淡入 */
@keyframes zoomIn {
    from {
        opacity: 0;
        transform: scale(0.95);
    }

    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* 缩放淡出 */
@keyframes zoomOut {
    from {
        opacity: 1;
        transform: scale(1);
    }

    to {
        opacity: 0;
        transform: scale(0.95);
    }
}

/* 进度条条纹动画 */
@keyframes progressBarStripes {
    from {
        background-position: 24px 0;
    }

    to {
        background-position: 0 0;
    }
}

/* 脉冲指示器 */
@keyframes ping {

    75%,
    100% {
        transform: scale(2);
        opacity: 0;
    }
}

/* 打字光标闪烁 */
@keyframes cursorBlink {

    0%,
    100% {
        opacity: 1;
    }

    50% {
        opacity: 0;
    }
}

/* 滑动上升 */
@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ========== @END-STABLE ========== */


/* ========== @STABLE: 组合动画工具类 ========== */
/* animate-in 系列 - 参考 Tailwind animate-in */
.animate-in {
    animation-duration: 0.5s;
    animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
    animation-fill-mode: forwards;
}

.animate-in.fade-in {
    animation-name: fadeIn;
}

.animate-in.zoom-in {
    animation-name: zoomIn;
}

.animate-in.slide-in-from-bottom {
    animation-name: slideInFromBottom;
}

.animate-in.slide-in-from-top {
    animation-name: slideInFromBottom;
    animation-direction: reverse;
}

/* 脉冲指示器 */
.animate-ping {
    animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
}

/* 呼吸脉冲 */
.animate-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

/* 慢速旋转 */
.animate-spin-slow {
    animation: spin 3s linear infinite;
}

/* 打字光标 */
.cursor-blink {
    animation: cursorBlink 1s step-end infinite;
}

/* ========== @END-STABLE ========== */


/* ========== @STABLE: 进度条组件 ========== */
.progress-bar {
    height: 24px;
    background: white;
    border-radius: var(--radius-full, 9999px);
    padding: 4px;
    border: 1px solid var(--border, #e2e8f0);
    box-shadow: var(--shadow-sm, 0 1px 2px 0 rgba(0, 0, 0, 0.05));
    overflow: hidden;
}

.progress-bar-fill {
    height: 100%;
    background: var(--accent, #6366f1);
    border-radius: var(--radius-full, 9999px);
    transition: width 0.5s ease-out;
    box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
    position: relative;
}

.progress-bar-fill::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(45deg,
            rgba(255, 255, 255, 0.15) 25%,
            transparent 25%,
            transparent 50%,
            rgba(255, 255, 255, 0.15) 50%,
            rgba(255, 255, 255, 0.15) 75%,
            transparent 75%,
            transparent);
    background-size: 24px 24px;
    animation: progressBarStripes 1s linear infinite;
}

/* ========== @END-STABLE ========== */


/* ========== @STABLE: 状态指示器 ========== */
.status-dot {
    position: relative;
    display: inline-flex;
    width: 8px;
    height: 8px;
}

.status-dot::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: currentColor;
    animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
    opacity: 0.75;
}

.status-dot::after {
    content: '';
    position: relative;
    display: inline-flex;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: currentColor;
}

.status-dot.success {
    color: var(--success, #10b981);
}

.status-dot.warning {
    color: var(--warning, #f59e0b);
}

.status-dot.danger {
    color: var(--danger, #ef4444);
}

.status-dot.accent {
    color: var(--accent, #6366f1);
}

/* ========== @END-STABLE ========== */


/* ========== @STABLE: 终端日志样式 ========== */
.terminal {
    background: #0f172a;
    border-radius: var(--radius-2xl, 32px);
    padding: 32px;
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
    font-size: 13px;
    color: #e2e8f0;
    overflow-y: auto;
    box-shadow: var(--shadow-xl, 0 25px 50px -12px rgba(0, 0, 0, 0.25));
}

.terminal-header {
    display: flex;
    align-items: center;
    gap: 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 16px;
    margin-bottom: 16px;
    color: rgba(255, 255, 255, 0.4);
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.terminal-dots {
    display: flex;
    gap: 6px;
}

.terminal-dots span {
    width: 10px;
    height: 10px;
    border-radius: 50%;
}

.terminal-dots span:nth-child(1) {
    background: rgba(239, 68, 68, 0.5);
}

.terminal-dots span:nth-child(2) {
    background: rgba(245, 158, 11, 0.5);
}

.terminal-dots span:nth-child(3) {
    background: rgba(16, 185, 129, 0.5);
}

.terminal-log {
    display: flex;
    gap: 12px;
    margin-bottom: 12px;
    animation: slideInFromBottom 0.3s ease forwards;
}

.terminal-log-num {
    color: rgba(255, 255, 255, 0.2);
    user-select: none;
}

.terminal-log-success {
    color: #818cf8;
    font-weight: 700;
}

/* ========== @END-STABLE ========== */

</style>
    <style>
        /* ========== 设计系统变量 ========== */
        :root {
            /* 主色 */
            --eva-primary: #6366F1;
            --eva-primary-light: #818CF8;
            --eva-primary-dark: #4F46E5;
            --eva-primary-bg: rgba(99, 102, 241, 0.08);

            /* 功能色 */
            --eva-success: #10B981;
            --eva-success-bg: rgba(16, 185, 129, 0.08);
            --eva-warning: #F59E0B;
            --eva-warning-bg: rgba(245, 158, 11, 0.08);
            --eva-error: #EF4444;
            --eva-error-bg: rgba(239, 68, 68, 0.08);
            --eva-info: #3B82F6;
            --eva-info-bg: rgba(59, 130, 246, 0.08);

            /* 中性色 */
            --eva-bg: #FAFAFA;
            --eva-surface: #FFFFFF;
            --eva-border: #E5E7EB;
            --eva-border-light: #F3F4F6;
            --eva-text-primary: #111827;
            --eva-text-secondary: #6B7280;
            --eva-text-tertiary: #9CA3AF;
            --eva-text-disabled: #D1D5DB;

            /* 阴影 */
            --eva-shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --eva-shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --eva-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --eva-shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

            /* 圆角 */
            --eva-radius-sm: 4px;
            --eva-radius-md: 8px;
            --eva-radius-lg: 12px;
            --eva-radius-xl: 16px;
            --eva-radius-full: 9999px;

            /* 间距 */
            --eva-space-xs: 4px;
            --eva-space-sm: 8px;
            --eva-space-md: 16px;
            --eva-space-lg: 24px;
            --eva-space-xl: 32px;
            --eva-space-2xl: 48px;

            /* 过渡 */
            --eva-transition-fast: 150ms ease;
            --eva-transition-normal: 250ms ease;
            --eva-transition-slow: 350ms ease;

            /* 布局 */
            --sidebar-width: 260px;
            --header-height: 56px;
        }

        /* ========== 重置样式 ========== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 14px;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--eva-bg);
            color: var(--eva-text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ========== 通用组件样式 ========== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--eva-space-sm);
            padding: var(--eva-space-sm) var(--eva-space-md);
            border: none;
            border-radius: var(--eva-radius-md);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--eva-transition-fast);
        }

        .btn-primary {
            background: var(--eva-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--eva-primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--eva-shadow-md);
        }

        .btn-secondary {
            background: var(--eva-surface);
            color: var(--eva-text-primary);
            border: 1px solid var(--eva-border);
        }

        .btn-secondary:hover {
            background: var(--eva-border-light);
        }

        .btn-ghost {
            background: transparent;
            color: var(--eva-text-secondary);
        }

        .btn-ghost:hover {
            background: var(--eva-border-light);
            color: var(--eva-text-primary);
        }

        /* 卡片 */
        .card {
            background: var(--eva-surface);
            border-radius: var(--eva-radius-lg);
            border: 1px solid var(--eva-border);
            padding: var(--eva-space-lg);
            transition: all var(--eva-transition-fast);
        }

        .card:hover {
            box-shadow: var(--eva-shadow-md);
        }

        /* 输入框 */
        .input {
            width: 100%;
            padding: var(--eva-space-sm) var(--eva-space-md);
            border: 1px solid var(--eva-border);
            border-radius: var(--eva-radius-md);
            font-size: 14px;
            transition: all var(--eva-transition-fast);
        }

        .input:focus {
            outline: none;
            border-color: var(--eva-primary);
            box-shadow: 0 0 0 3px var(--eva-primary-bg);
        }

        /* 标签 */
        .tag {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: var(--eva-radius-full);
            font-size: 12px;
            font-weight: 500;
        }

        .tag-primary {
            background: var(--eva-primary-bg);
            color: var(--eva-primary);
        }

        .tag-success {
            background: var(--eva-success-bg);
            color: var(--eva-success);
        }

        .tag-warning {
            background: var(--eva-warning-bg);
            color: var(--eva-warning);
        }

        .tag-error {
            background: var(--eva-error-bg);
            color: var(--eva-error);
        }

        /* ========== 动画 ========== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .animate-fade-in {
            animation: fadeIn var(--eva-transition-normal);
        }

        .animate-slide-up {
            animation: slideUp var(--eva-transition-normal);
        }

        .animate-pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        /* ========== 加载骨架屏 ========== */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--eva-radius-sm);
        }

        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
    <!-- ========== @END-FROZEN: 设计系统核心样式 ========== -->

    <style>
        /* ========== Agent进化页面特有样式 ========== */
        /* TODO: 在此添加模块特定样式 */

        /* ========== 布局对齐：复刻控制台结构 ========== */
        body {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: var(--sidebar-width);
            background: var(--eva-surface);
            border-right: 1px solid var(--eva-border);
            position: sticky;
            top: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            z-index: 20;
            flex-shrink: 0;
        }

        .logo {
            height: 72px;
            display: flex;
            align-items: center;
            padding: 0 28px;
            font-weight: 700;
            font-size: 20px;
            border-bottom: 1px solid var(--eva-border);
            gap: 10px;
            color: var(--eva-primary);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--eva-primary) 0%, var(--eva-primary-dark) 100%);
            border-radius: var(--eva-radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .nav-section {
            padding: 20px 16px;
        }

        .nav-section:not(:last-child) {
            border-bottom: 1px solid var(--eva-border-light);
        }

        .nav-label {
            font-size: 10px;
            font-weight: 700;
            color: var(--eva-text-tertiary);
            text-transform: uppercase;
            padding: 0 12px 10px;
            letter-spacing: 0.1em;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            font-size: 14px;
            border-radius: var(--eva-radius-md);
            color: var(--eva-text-secondary);
            cursor: pointer;
            transition: all .2s;
            font-weight: 500;
            text-decoration: none;
            position: relative;
        }

        .nav-item:hover {
            background: var(--eva-border-light);
            color: var(--eva-text-primary);
        }

        .nav-item.active {
            background: var(--eva-primary-bg);
            color: var(--eva-primary);
            font-weight: 600;
        }

        .nav-item-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            margin-top: auto;
            border-top: 1px solid var(--eva-border);
            cursor: pointer;
            transition: background 0.2s;
        }

        .user-profile:hover {
            background: var(--eva-border-light);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--eva-primary), var(--eva-primary-dark));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--eva-text-primary);
        }

        .user-company {
            font-size: 12px;
            color: var(--eva-text-secondary);
        }

        .user-expand {
            color: var(--eva-text-tertiary);
            font-size: 10px;
        }

        .main {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }

        .topbar {
            height: var(--header-height);
            background: var(--eva-surface);
            border-bottom: 1px solid var(--eva-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            position: sticky;
            top: 0;
            z-index: 19;
        }

        .topbar-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--eva-text-primary);
        }

        .topbar-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .content {
            padding: 32px;
            max-width: 980px;
            margin: 0 auto;
            width: 100%;
        }

        .hint-pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid var(--eva-border);
            background: var(--eva-surface);
            color: var(--eva-text-secondary);
            font-size: 12px;
        }

        /* ========== 手风琴（能力卡片） ========== */
        .ability-accordion {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .ability-card {
            --ability-color: var(--eva-primary);
            --ability-color-bg: var(--eva-primary-bg);
            border-radius: 16px;
            border: 1px solid var(--eva-border);
            background: var(--eva-surface);
            box-shadow: var(--eva-shadow-sm);
            overflow: hidden;
            transition: box-shadow var(--eva-transition-fast), border-color var(--eva-transition-fast), transform var(--eva-transition-fast);
        }

        .ability-card:hover {
            box-shadow: var(--eva-shadow-md);
            transform: translateY(-1px);
        }

        .ability-card.is-open {
            border-color: color-mix(in srgb, var(--ability-color) 22%, var(--eva-border));
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .ability-header {
            width: 100%;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 16px;
            align-items: center;
            padding: 16px 16px;
            cursor: pointer;
            user-select: none;
        }

        .ability-header:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--ability-color) 18%, transparent);
        }

        .ability-title {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 0;
        }

        .ability-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            background: color-mix(in srgb, var(--ability-color) 12%, white);
            border: 1px solid color-mix(in srgb, var(--ability-color) 22%, var(--eva-border));
            font-size: 18px;
            flex-shrink: 0;
        }

        .ability-name-row {
            display: flex;
            align-items: baseline;
            gap: 10px;
            min-width: 0;
        }

        .ability-name {
            font-size: 14px;
            font-weight: 800;
            color: var(--eva-text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .version-badge {
            position: relative;
            height: 18px;
            padding: 0 8px;
            border-radius: 999px;
            border: 1px solid var(--eva-border);
            background: var(--eva-surface);
            color: var(--eva-text-secondary);
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            overflow: hidden;
        }

        .version-clip {
            height: 18px;
            overflow: hidden;
            display: inline-flex;
            align-items: flex-start;
        }

        .version-stack {
            display: flex;
            flex-direction: column;
            transform: translateY(0);
        }

        .version-item {
            height: 18px;
            display: flex;
            align-items: center;
        }

        .version-badge.rolling .version-stack {
            animation: versionRoll 900ms cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        @keyframes versionRoll {
            from { transform: translateY(0); }
            to { transform: translateY(-18px); }
        }

        .ability-sub {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 6px;
            flex-wrap: wrap;
        }

        .progress {
            flex: 1;
            min-width: 240px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-track {
            flex: 1;
            height: 10px;
            border-radius: 999px;
            background: var(--eva-border-light);
            border: 1px solid var(--eva-border);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            border-radius: 999px;
            background: linear-gradient(90deg, color-mix(in srgb, var(--ability-color) 78%, white), var(--ability-color));
            transition: width 500ms ease;
        }

        .progress-meta {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--eva-text-secondary);
            font-size: 12px;
            white-space: nowrap;
        }

        .status-dot {
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: var(--eva-text-tertiary);
        }

        .status-dot.evolvable {
            background: var(--eva-success);
            box-shadow: 0 0 0 4px var(--eva-success-bg);
        }

        .ability-actions {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-pill {
            height: 32px;
            padding: 0 10px;
            border-radius: 10px;
            border: 1px solid var(--eva-border);
            background: var(--eva-surface);
            color: var(--eva-text-secondary);
            font-size: 12px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all var(--eva-transition-fast);
        }

        .toggle-pill:hover {
            background: var(--eva-border-light);
            color: var(--eva-text-primary);
        }

        .toggle-pill .chev {
            transition: transform var(--eva-transition-normal);
        }

        .ability-card.is-open .toggle-pill .chev {
            transform: rotate(180deg);
        }

        .ability-details {
            height: 0;
            overflow: hidden;
            border-top: 1px solid var(--eva-border);
            background: linear-gradient(180deg, color-mix(in srgb, var(--ability-color) 6%, white), white 40%);
            transition: height var(--eva-transition-slow);
        }

        .ability-details-inner {
            padding: 16px;
            display: grid;
            gap: 14px;
        }

        .detail-row {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            gap: 12px;
            flex-wrap: wrap;
        }

        .detail-title {
            font-size: 13px;
            font-weight: 800;
            color: var(--eva-text-primary);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .detail-sub {
            font-size: 12px;
            color: var(--eva-text-secondary);
        }

        .queue {
            display: grid;
            gap: 10px;
        }

        .queue-item {
            border: 1px solid var(--eva-border);
            background: var(--eva-surface);
            border-radius: 14px;
            padding: 12px;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 12px;
            align-items: center;
        }

        .queue-q {
            font-size: 13px;
            font-weight: 650;
            color: var(--eva-text-primary);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .queue-meta {
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .source-pill {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 12px;
            border: 1px solid var(--eva-border);
            color: var(--eva-text-secondary);
            background: var(--eva-surface);
        }

        .issue-pill {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 12px;
            background: color-mix(in srgb, var(--eva-warning) 14%, white);
            border: 1px solid color-mix(in srgb, var(--eva-warning) 28%, var(--eva-border));
            color: color-mix(in srgb, var(--eva-warning) 90%, black);
        }

        .issue-pill.gap {
            background: var(--eva-error-bg);
            border: 1px solid color-mix(in srgb, var(--eva-error) 28%, var(--eva-border));
            color: var(--eva-error);
        }

        .queue-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-small {
            padding: 8px 10px;
            border-radius: 10px;
            font-size: 13px;
        }

        .btn-ability {
            background: var(--ability-color);
            color: white;
        }

        .btn-ability:hover {
            filter: brightness(0.95);
            box-shadow: 0 8px 18px color-mix(in srgb, var(--ability-color) 30%, transparent);
            transform: translateY(-1px);
        }

        .btn-disabled,
        .btn:disabled {
            cursor: not-allowed;
            opacity: 0.55;
            box-shadow: none !important;
            transform: none !important;
        }

        .empty-queue {
            border: 1px dashed var(--eva-border);
            background: color-mix(in srgb, var(--eva-border-light) 60%, white);
            border-radius: 14px;
            padding: 16px;
            color: var(--eva-text-secondary);
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .empty-emoji {
            width: 38px;
            height: 38px;
            border-radius: 12px;
            background: white;
            border: 1px solid var(--eva-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .evolve-bar {
            margin-top: 2px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            flex-wrap: wrap;
        }

        .evolve-cta {
            background: linear-gradient(135deg, var(--ability-color), color-mix(in srgb, var(--ability-color) 60%, black));
            color: white;
            border: none;
        }

        .evolve-cta:hover {
            transform: translateY(-1px);
            box-shadow: 0 12px 24px color-mix(in srgb, var(--ability-color) 26%, transparent);
        }

        /* ========== 进化动效 ========== */
        .ability-card.is-evolving {
            position: relative;
            border-color: color-mix(in srgb, var(--ability-color) 40%, var(--eva-border));
            box-shadow: 0 0 0 1px color-mix(in srgb, var(--ability-color) 26%, transparent),
                        0 18px 55px color-mix(in srgb, var(--ability-color) 26%, transparent);
        }

        .ability-card.is-evolving::after {
            content: "";
            position: absolute;
            inset: -2px;
            border-radius: 18px;
            background: radial-gradient(600px 120px at 20% 20%, color-mix(in srgb, var(--ability-color) 22%, transparent), transparent 60%),
                        radial-gradient(600px 120px at 80% 80%, color-mix(in srgb, var(--ability-color) 18%, transparent), transparent 60%);
            pointer-events: none;
            animation: evolveAura 2.4s ease-in-out;
        }

        @keyframes evolveAura {
            0% { opacity: 0; transform: scale(0.985); }
            18% { opacity: 1; transform: scale(1.0); }
            100% { opacity: 0; transform: scale(1.01); }
        }

        .sparkles {
            position: absolute;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .sparkle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: color-mix(in srgb, var(--ability-color) 55%, white);
            filter: blur(0.2px);
            opacity: 0;
            animation: sparkle 900ms ease-in-out forwards;
        }

        @keyframes sparkle {
            0% { opacity: 0; transform: translateY(6px) scale(0.6); }
            35% { opacity: 0.9; }
            100% { opacity: 0; transform: translateY(-26px) scale(1.2); }
        }

        /* ========== 弹窗 ========== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(17, 24, 39, 0.55);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 12000;
            padding: 24px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            width: 100%;
            max-width: 760px;
            background: var(--eva-surface);
            border-radius: 20px;
            border: 1px solid var(--eva-border);
            box-shadow: var(--eva-shadow-xl);
            overflow: hidden;
        }

        .modal.sm {
            max-width: 560px;
        }

        .modal-header {
            padding: 16px;
            border-bottom: 1px solid var(--eva-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .modal-title {
            font-size: 14px;
            font-weight: 800;
            color: var(--eva-text-primary);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .modal-body {
            padding: 16px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .modal-footer {
            padding: 14px 16px;
            border-top: 1px solid var(--eva-border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            flex-wrap: wrap;
        }

        .modal-close {
            width: 34px;
            height: 34px;
            border-radius: 10px;
            border: 1px solid var(--eva-border);
            background: var(--eva-surface);
            cursor: pointer;
            color: var(--eva-text-secondary);
            transition: all var(--eva-transition-fast);
        }

        .modal-close:hover {
            background: var(--eva-border-light);
            color: var(--eva-text-primary);
        }

        .block {
            border: 1px solid var(--eva-border);
            border-radius: 14px;
            padding: 12px;
            background: var(--eva-surface);
        }

        .block-label {
            font-size: 12px;
            font-weight: 800;
            color: var(--eva-text-secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mono {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }

        .radio-list {
            display: grid;
            gap: 10px;
        }

        .radio-card {
            border: 1px solid var(--eva-border);
            border-radius: 14px;
            padding: 12px;
            background: var(--eva-surface);
            cursor: pointer;
            transition: all var(--eva-transition-fast);
            display: grid;
            gap: 8px;
        }

        .radio-card:hover {
            box-shadow: var(--eva-shadow-sm);
            border-color: color-mix(in srgb, var(--eva-primary) 18%, var(--eva-border));
        }

        .radio-card.selected {
            border-color: color-mix(in srgb, var(--eva-primary) 36%, var(--eva-border));
            box-shadow: 0 0 0 3px var(--eva-primary-bg);
        }

        .radio-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .radio-dot {
            width: 14px;
            height: 14px;
            border-radius: 999px;
            border: 2px solid var(--eva-border);
            display: inline-block;
            position: relative;
            flex-shrink: 0;
        }

        .radio-card.selected .radio-dot {
            border-color: var(--eva-primary);
        }

        .radio-card.selected .radio-dot::after {
            content: "";
            position: absolute;
            inset: 3px;
            border-radius: 999px;
            background: var(--eva-primary);
        }

        .counter {
            font-size: 12px;
            color: var(--eva-text-secondary);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .counter .chip {
            padding: 2px 8px;
            border-radius: 999px;
            border: 1px solid var(--eva-border);
            background: var(--eva-surface);
        }

        .success-hero {
            padding: 22px 16px 8px;
            display: grid;
            place-items: center;
            gap: 10px;
        }

        .success-icon {
            width: 64px;
            height: 64px;
            border-radius: 18px;
            display: grid;
            place-items: center;
            color: white;
            background: linear-gradient(135deg, var(--eva-success), #059669);
            box-shadow: 0 14px 30px rgba(16, 185, 129, 0.25);
            font-size: 28px;
        }

        .success-title {
            font-size: 18px;
            font-weight: 900;
            color: var(--eva-text-primary);
        }

        .success-desc {
            text-align: center;
            color: var(--eva-text-secondary);
            font-size: 13px;
        }

        /* ========== Toast ========== */
        .toast {
            position: fixed;
            left: 50%;
            bottom: 28px;
            transform: translateX(-50%);
            background: rgba(17, 24, 39, 0.92);
            color: white;
            padding: 10px 12px;
            border-radius: 12px;
            font-size: 13px;
            display: none;
            z-index: 13000;
            box-shadow: 0 12px 28px rgba(0,0,0,0.18);
            max-width: min(520px, calc(100vw - 40px));
        }

        .toast.active {
            display: block;
            animation: toastIn 180ms ease;
        }

        @keyframes toastIn {
            from { opacity: 0; transform: translateX(-50%) translateY(8px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        /* ========== 响应式 ========== */
        @media (max-width: 980px) {
            .content { max-width: 860px; }
        }

        @media (max-width: 860px) {
            .sidebar { display: none; }
            body { display: block; }
            .topbar { padding: 0 16px; }
            .content { padding: 16px; }
            .progress { min-width: 180px; }
        }


        /* ========== @FROZEN: 画板模式核心架构 ========== -->

        /* 模式切换器 */
        .mode-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            gap: 8px;
            background: white;
            padding: 8px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border: 1px solid #E5E7EB;
        }

        .mode-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            background: #F3F4F6;
            color: #6B7280;
        }

        .mode-btn:hover {
            background: #E5E7EB;
            color: #374151;
        }

        .mode-btn.active {
            background: var(--eva-primary);
            color: white;
        }

        .mode-btn-export {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
        }

        .mode-btn-export:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* 画板容器 - 默认隐藏 */
        .artboard-container {
            display: none;
            padding: 40px;
            background: #F8FAFC;
            min-height: 100vh;
        }

        .artboard-container.active {
            display: block;
        }

        .artboard-header {
            text-align: center;
            margin-bottom: 48px;
            padding: 32px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .artboard-header h1 {
            font-size: 28px;
            font-weight: 700;
            color: #1F2937;
            margin-bottom: 8px;
        }

        .artboard-header p {
            font-size: 16px;
            color: #6B7280;
        }

        /* 画板网格 */
        .artboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 32px;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* 画板单元 */
        .artboard {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s ease;
        }

        .artboard:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .artboard-label {
            background: #1F2937;
            color: white;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .artboard-label span:first-child {
            flex: 1;
        }

        .artboard-label-id {
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .artboard-download-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s ease;
            margin-right: 8px;
        }

        .artboard-download-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .artboard-content {
            padding: 16px;
            background: #F9FAFB;
        }

        .artboard-content.tall {
            min-height: 640px;
        }

        .artboard-page-preview {
            transform: scale(0.75);
            transform-origin: top left;
            width: 133.33%;
            height: auto;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* 画板区块标题 */
        .artboard-section-title {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 24px 0 8px;
            padding: 12px 0;
            border-bottom: 2px solid #E5E7EB;
            position: relative;
        }

        .artboard-section-title::after {
            content: attr(data-title);
            font-size: 18px;
            font-weight: 600;
            color: #374151;
        }

        .artboard-section-title span {
            font-size: 24px;
        }

        /* 打印样式 */
        @media print {
            .mode-switcher {
                display: none !important;
            }

            .artboard-container {
                display: block !important;
                padding: 0;
            }

            .artboard {
                break-inside: avoid;
                page-break-inside: avoid;
                margin-bottom: 20px;
            }
        }

        /* 响应式 */
        @media (max-width: 768px) {
            .artboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .artboard-container {
                padding: 20px;
            }

            .mode-switcher {
                top: 10px;
                right: 10px;
                flex-direction: column;
            }
        }

        /* 画板模式激活时隐藏交互模式 */
        body.artboard-mode .sidebar,
        body.artboard-mode .main {
            display: none;
        }
    </style>
</head>

<body>
    <!-- ========== 模式切换器 ========== -->
    <div class="mode-switcher">
        <button class="mode-btn active" onclick="switchMode('interactive')">
            <span style="margin-right: 4px;">&#128421;</span> 交互模式
        </button>
        <button class="mode-btn" onclick="switchMode('artboard')">
            <span style="margin-right: 4px;">&#128203;</span> 画板模式
        </button>
        <button class="mode-btn mode-btn-export" onclick="copyPrototypeHtml()">
            <span style="margin-right: 4px;">&#128203;</span> 复制HTML
        </button>
    </div>

    <!-- ========== 画板容器 ========== -->
    <div class="artboard-container" id="artboardContainer">
        <div class="artboard-header">
            <h1>🧬 Agent进化 · 原型画板</h1>
            <p>展示能力卡片的关键状态（正常 / 可进化 / 空状态 / 进化中）</p>
        </div>

        <div class="artboard-grid">
            <div class="artboard-section-title" data-title="页面预览">
                <span>&#128196;</span>
            </div>

            <div class="artboard" id="artboard-1">
                <div class="artboard-label">
                    <span>Agent进化 默认页面（克隆交互模式）</span>
                    <button class="artboard-download-btn" onclick="captureArtboard('artboard-1', '01-Agent进化-默认页面')">&#11015;</button>
                    <span class="artboard-label-id">#1</span>
                </div>
                <div class="artboard-content tall">
                    <div class="artboard-page-preview"></div>
                </div>
            </div>

            <div class="artboard-section-title" data-title="能力卡片状态">
                <span>&#129504;</span>
            </div>

            <div class="artboard" id="artboard-2">
                <div class="artboard-label">
                    <span>可进化（100%）</span>
                    <button class="artboard-download-btn" onclick="captureArtboard('artboard-2', '02-Agent进化-可进化')">&#11015;</button>
                    <span class="artboard-label-id">#2</span>
                </div>
                <div class="artboard-content">
                    <div class="ability-card is-open" style="--ability-color:#8B5CF6;--ability-color-bg:rgba(139,92,246,0.08); pointer-events:none;">
                        <div class="ability-header">
                            <div>
                                <div class="ability-title">
                                    <div class="ability-icon">💼</div>
                                    <div style="min-width:0;">
                                        <div class="ability-name-row">
                                            <div class="ability-name">销售推广</div>
                                            <span class="version-badge"><span class="version-clip"><span class="version-stack"><span class="version-item">v2.0</span><span class="version-item">v3.0</span></span></span></span>
                                        </div>
                                        <div class="ability-sub">
                                            <div class="progress">
                                                <div class="progress-track"><div class="progress-fill" style="width:100%"></div></div>
                                                <div class="progress-meta"><span class="status-dot evolvable"></span><span>100%</span><span>·</span><span>可进化！</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="ability-actions">
                                <div class="toggle-pill">展开 <span class="chev">▾</span></div>
                            </div>
                        </div>
                        <div class="ability-details" style="height:auto;">
                            <div class="ability-details-inner">
                                <div class="detail-row">
                                    <div class="detail-title">📋 待调优队列</div>
                                    <div class="detail-sub">已处理 50 / 待处理 50</div>
                                </div>
                                <div class="empty-queue">
                                    <div class="empty-emoji">✅</div>
                                    <div>
                                        <div style="font-weight:800; color:var(--eva-text-primary);">已完成本轮调优</div>
                                        <div style="margin-top:4px;">可点击「进化」发布新版本。</div>
                                    </div>
                                </div>
                                <div class="evolve-bar">
                                    <button class="btn btn-small evolve-cta">进化发布</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="artboard" id="artboard-3">
                <div class="artboard-label">
                    <span>空状态（无待调优题目）</span>
                    <button class="artboard-download-btn" onclick="captureArtboard('artboard-3', '03-Agent进化-空状态')">&#11015;</button>
                    <span class="artboard-label-id">#3</span>
                </div>
                <div class="artboard-content">
                    <div class="ability-card is-open" style="--ability-color:#10B981;--ability-color-bg:rgba(16,185,129,0.08); pointer-events:none;">
                        <div class="ability-header">
                            <div>
                                <div class="ability-title">
                                    <div class="ability-icon">💬</div>
                                    <div style="min-width:0;">
                                        <div class="ability-name-row">
                                            <div class="ability-name">智能客服</div>
                                            <span class="version-badge"><span class="version-clip"><span class="version-stack"><span class="version-item">v4.0</span><span class="version-item">v5.0</span></span></span></span>
                                        </div>
                                        <div class="ability-sub">
                                            <div class="progress">
                                                <div class="progress-track"><div class="progress-fill" style="width:0%"></div></div>
                                                <div class="progress-meta"><span class="status-dot"></span><span>0%</span><span>·</span><span>暂无待调优题目</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="ability-actions">
                                <div class="toggle-pill">展开 <span class="chev">▾</span></div>
                            </div>
                        </div>
                        <div class="ability-details" style="height:auto;">
                            <div class="ability-details-inner">
                                <div class="detail-row">
                                    <div class="detail-title">📋 待调优队列</div>
                                    <div class="detail-sub">已处理 0 / 待处理 0</div>
                                </div>
                                <div class="empty-queue">
                                    <div class="empty-emoji">📭</div>
                                    <div>
                                        <div style="font-weight:800; color:var(--eva-text-primary);">暂无待调优题目</div>
                                        <div style="margin-top:4px;">当前能力表现良好，可去题库运行评测发现新的改进点。</div>
                                    </div>
                                </div>
                                <div class="evolve-bar">
                                    <button class="btn btn-small btn-secondary">去题库 →</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="artboard" id="artboard-4">
                <div class="artboard-label">
                    <span>进化中（动效中）</span>
                    <button class="artboard-download-btn" onclick="captureArtboard('artboard-4', '04-Agent进化-进化中')">&#11015;</button>
                    <span class="artboard-label-id">#4</span>
                </div>
                <div class="artboard-content">
                    <div class="ability-card is-open is-evolving" style="--ability-color:#3B82F6;--ability-color-bg:rgba(59,130,246,0.08); pointer-events:none;">
                        <div class="sparkles">
                            <div class="sparkle" style="left:18%; top:30%;"></div>
                            <div class="sparkle" style="left:56%; top:42%; animation-delay:120ms;"></div>
                            <div class="sparkle" style="left:82%; top:26%; animation-delay:220ms;"></div>
                        </div>
                        <div class="ability-header">
                            <div>
                                <div class="ability-title">
                                    <div class="ability-icon">✍️</div>
                                    <div style="min-width:0;">
                                        <div class="ability-name-row">
                                            <div class="ability-name">内容营销</div>
                                            <span class="version-badge rolling"><span class="version-clip"><span class="version-stack"><span class="version-item">v2.0</span><span class="version-item">v3.0</span></span></span></span>
                                        </div>
                                        <div class="ability-sub">
                                            <div class="progress">
                                                <div class="progress-track"><div class="progress-fill" style="width:100%"></div></div>
                                                <div class="progress-meta"><span class="status-dot"></span><span>进化中…</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="ability-actions">
                                <div class="toggle-pill">展开 <span class="chev">▾</span></div>
                            </div>
                        </div>
                        <div class="ability-details" style="height:auto;">
                            <div class="ability-details-inner">
                                <div class="detail-row">
                                    <div class="detail-title">✨ 正在进化</div>
                                    <div class="detail-sub">版本升级 · 进度归零 · 学习中</div>
                                </div>
                                <div class="empty-queue">
                                    <div class="empty-emoji">🧬</div>
                                    <div>
                                        <div style="font-weight:800; color:var(--eva-text-primary);">Agent 正在学习新内容</div>
                                        <div style="margin-top:4px;">约 2-3 秒完成。</div>
                                    </div>
                                </div>
                                <div class="evolve-bar">
                                    <button class="btn btn-small btn-disabled" disabled>进化发布</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== 交互模式：侧边栏 ========== -->
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-icon">E</div>
            EVA
        </div>

        <div class="nav-section">
            <div class="nav-label">核心模块</div>
            <a class="nav-item" href="javascript:void(0)">
                <div class="nav-item-icon">🏠</div>
                控制台
            </a>
            <a class="nav-item" href="javascript:void(0)">
                <div class="nav-item-icon">🤖</div>
                Agent演练
            </a>
            <a class="nav-item" href="javascript:void(0)">
                <div class="nav-item-icon">📚</div>
                知识库
            </a>
            <a class="nav-item active" href="javascript:void(0)">
                <div class="nav-item-icon">🧬</div>
                Agent进化
            </a>
            <a class="nav-item" href="javascript:void(0)">
                <div class="nav-item-icon">📝</div>
                题库
            </a>
        </div>

        <div class="nav-section">
            <div class="nav-label">管理</div>
            <a class="nav-item" href="javascript:void(0)">
                <div class="nav-item-icon">🚀</div>
                部署
            </a>
            <a class="nav-item" href="javascript:void(0)">
                <div class="nav-item-icon">🛡️</div>
                安全合规
            </a>
        </div>

        <div class="user-profile">
            <div class="user-avatar">张</div>
            <div class="user-info">
                <div class="user-name">张三</div>
                <div class="user-company">ABC科技</div>
            </div>
            <div class="user-expand">▼</div>
        </div>
    </aside>

    <!-- ========== 交互模式：主区域 ========== -->
    <div class="main">
        <div class="topbar">
            <div class="topbar-title">Agent进化</div>
            <div class="topbar-actions">
                <div class="hint-pill">单开手风琴 · 进度满 100% 可进化</div>
            </div>
        </div>

        <div class="content" id="mainContent">
            <div class="ability-accordion" id="abilityAccordion"></div>
        </div>
    </div>

    <!-- ========== 弹窗组件 ========== -->
    <div class="modal-overlay" id="modalOverlay" aria-hidden="true">
        <!-- 调优弹窗 -->
        <div class="modal" id="modalTune" role="dialog" aria-modal="true" aria-labelledby="tuneTitle" style="display:none;">
            <div class="modal-header">
                <div class="modal-title" id="tuneTitle">
                    调优题目
                    <span class="counter" id="tuneCounter">
                        <span class="chip">1/50</span>
                    </span>
                </div>
                <button class="modal-close" data-action="close-modal" aria-label="关闭">✕</button>
            </div>
            <div class="modal-body">
                <div class="block">
                    <div class="block-label">📝 原问题</div>
                    <div id="tuneQuestionText"></div>
                </div>
                <div class="block">
                    <div class="block-label">🤖 Agent 原回答</div>
                    <div id="tuneAgentAnswer"></div>
                </div>
                <div class="block">
                    <div class="block-label">⚠️ 问题标签</div>
                    <div id="tuneIssueTag" class="tag tag-warning"></div>
                </div>

                <div class="block">
                    <div class="block-label">✨ 请选择更好的回答</div>
                    <div class="radio-list" id="tuneCandidates"></div>
                    <div class="block" style="border-style:dashed;">
                        <div class="block-label">○ 自行作答</div>
                        <textarea class="input" id="tuneCustomAnswer" rows="4" placeholder="请输入您认为更好的回答..."></textarea>
                        <div style="margin-top:8px; font-size:12px; color:var(--eva-text-tertiary);">提示：输入自行作答会取消已选候选答案。</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="skip-tune">跳过</button>
                <button class="btn btn-primary" data-action="submit-tune">提交</button>
            </div>
        </div>

        <!-- 进化确认弹窗 -->
        <div class="modal sm" id="modalEvolveConfirm" role="dialog" aria-modal="true" aria-labelledby="evolveConfirmTitle" style="display:none;">
            <div class="modal-header">
                <div class="modal-title" id="evolveConfirmTitle">确认进化</div>
                <button class="modal-close" data-action="close-modal" aria-label="关闭">✕</button>
            </div>
            <div class="modal-body">
                <div class="block" id="evolveConfirmIntro"></div>
                <div class="block">
                    <div class="block-label">📊 本次调优摘要</div>
                    <div id="evolveConfirmSummary" class="mono" style="font-size:13px; color:var(--eva-text-primary); line-height:1.65;"></div>
                </div>
                <div class="block">
                    <div class="block-label">进化后</div>
                    <div style="font-size:13px; color:var(--eva-text-secondary); line-height:1.65;">
                        • Agent 将学习本次调优内容<br />
                        • 调优进度重置，新一轮开始<br />
                        • <span id="evolveConfirmVersionLine" style="color:var(--eva-text-primary); font-weight:700;"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="cancel-evolve">取消</button>
                <button class="btn btn-primary" data-action="confirm-evolve">确认进化</button>
            </div>
        </div>

        <!-- 进化成功弹窗 -->
        <div class="modal sm" id="modalEvolveSuccess" role="dialog" aria-modal="true" aria-labelledby="evolveSuccessTitle" style="display:none;">
            <div class="modal-header">
                <div class="modal-title" id="evolveSuccessTitle">进化成功</div>
                <button class="modal-close" data-action="close-modal" aria-label="关闭">✕</button>
            </div>
            <div class="modal-body">
                <div class="success-hero">
                    <div class="success-icon">✨</div>
                    <div class="success-title">进化成功！</div>
                    <div class="success-desc" id="evolveSuccessDesc"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" data-action="close-modal">完成</button>
            </div>
        </div>

        <!-- 知识缺口提示弹窗 -->
        <div class="modal sm" id="modalKnowledgeGap" role="dialog" aria-modal="true" aria-labelledby="gapTitle" style="display:none;">
            <div class="modal-header">
                <div class="modal-title" id="gapTitle">⚠️ 无法调优</div>
                <button class="modal-close" data-action="close-modal" aria-label="关闭">✕</button>
            </div>
            <div class="modal-body">
                <div class="block" style="border-color: color-mix(in srgb, var(--eva-error) 20%, var(--eva-border)); background: var(--eva-error-bg);">
                    <div style="font-size:13px; color:var(--eva-text-primary); line-height:1.7;">
                        此题被判定为「知识缺口」，表示知识库中缺少相关资料。<br />
                        调优无法解决知识缺口问题，请先去知识库补充相关资料。<br />
                        补充完成后，重新运行评测，题目会自动更新状态。
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="close-modal">返回队列</button>
                <button class="btn btn-primary" data-action="go-knowledge">去知识库补充 →</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <!-- ========== Agent进化：交互逻辑（非FROZEN） ========== -->
    <script>
        const AgentEvolution = (() => {
            const abilities = [
                {
                    id: 'customer_service',
                    name: '智能客服',
                    icon: '💬',
                    color: '#10B981',
                    version: 'v3.0',
                    totalCount: 50,
                    processedCount: 34,
                    pendingCount: 16,
                    candidateCount: 22,
                    customCount: 12,
                    skippedCount: 0,
                    queue: [
                        {
                            id: 'cs-1',
                            question: '跨境订单的退换货时效如何计算？',
                            source: '官方题库',
                            issueLabel: '缺关键点',
                            agentAnswer: '一般情况下，退换货时效以签收时间为准。建议提供订单号，我来帮您确认具体规则与节点。',
                            candidateAnswers: [
                                '跨境订单退换货时效通常从“签收次日”开始计算。不同国家/地区与物流方式可能不同：建议您提供订单号与目的地，我会给出明确的最晚申请时间与寄回截止时间。',
                                '非常理解您担心错过时效。跨境订单一般以签收时间为起点计算退换货期限，同时可能受清关与仓配影响。您把订单号发我，我可以立刻核对适用规则并给到可操作的步骤。',
                                '跨境退换货时效通常会写在商品页与售后政策中，建议以“签收时间”作为起点。若您告诉我订单号/目的地，我可以确认具体天数与注意事项。'
                            ]
                        },
                        {
                            id: 'cs-2',
                            question: '用户说“我不满意”，你要怎么安抚并推进处理？',
                            source: '用户点踩',
                            issueLabel: '缺同理心',
                            agentAnswer: '好的，我帮您查一下订单情况。请问您的订单号是多少？',
                            candidateAnswers: [
                                '非常抱歉给您带来不好的体验，我完全理解您的心情。您方便告诉我具体是哪方面让您不满意吗？我会第一时间帮您解决，并给到明确的处理进度。',
                                '理解您的心情，遇到这种情况确实让人着急。我先帮您快速定位问题：请问是订单、物流还是商品本身？同时把订单号发我，我马上处理。',
                                '感谢您的反馈，让我了解一下具体情况。您方便说下不满意的点吗？我会给您一个可执行的解决方案，并持续跟进到问题解决。'
                            ]
                        },
                        {
                            id: 'cs-3',
                            question: '是否可以承诺“100%当天退款”？',
                            source: '官方题库',
                            issueLabel: '需拒答',
                            agentAnswer: '可以的，我们支持当天退款。',
                            candidateAnswers: [
                                '我理解您希望尽快到账，但我无法承诺“100%当天到账”。退款发起后通常需要 1-3 个工作日，具体以支付渠道处理为准。我可以帮您尽快提交并告知预计时间。',
                                '为避免误导，我不能保证一定当天到账。我们会在审核通过后立即发起退款，到账时间取决于银行/支付平台。我可以帮您查询当前退款状态与预计到账时间。',
                                '很抱歉我不能承诺“必定当天退款到账”。我可以为您加急提交退款申请，并同步退款进度；您提供订单号后我马上处理。'
                            ]
                        }
                    ]
                },
                {
                    id: 'content_marketing',
                    name: '内容营销',
                    icon: '✍️',
                    color: '#3B82F6',
                    version: 'v2.0',
                    totalCount: 50,
                    processedCount: 16,
                    pendingCount: 34,
                    candidateCount: 10,
                    customCount: 6,
                    skippedCount: 0,
                    queue: [
                        {
                            id: 'cm-1',
                            question: '帮我写一条新品“智能扫地机器人”的小红书种草标题（不超过20字）。',
                            source: '自建题库',
                            issueLabel: '缺亮点',
                            agentAnswer: '智能扫地机器人很好用，推荐购买。',
                            candidateAnswers: [
                                '懒人救星！扫地机器人真的省时',
                                '我家地面像被“重做”了一遍',
                                '入住后最不后悔的智能家电'
                            ]
                        },
                        {
                            id: 'cm-2',
                            question: '双11大促：帮我写3条“限时优惠”文案，语气要克制但有紧迫感。',
                            source: '官方题库',
                            issueLabel: '缺节奏',
                            agentAnswer: '现在优惠很大，快来买。',
                            candidateAnswers: [
                                '仅限今日：价格已到位，错过要等一年。',
                                '库存与优惠同步递减：建议现在下单锁定。',
                                '最后一轮放价：想要就别再观望。'
                            ]
                        },
                        {
                            id: 'cm-3',
                            question: '为“会员续费”写一段短信，避免过度营销，强调价值点。',
                            source: '自建题库',
                            issueLabel: '缺价值',
                            agentAnswer: '续费会员有很多好处，请立即续费。',
                            candidateAnswers: [
                                '您的会员即将到期：续费可继续享受专属权益与服务支持，随时可在App内一键续费。',
                                '会员到期提醒：续费后可继续使用高频功能与专属资源，感谢一路相伴。',
                                '温馨提示：会员将到期，续费可保持权益不中断；如需帮助请随时联系。'
                            ]
                        }
                    ]
                },
                {
                    id: 'sales_promotion',
                    name: '销售推广',
                    icon: '💼',
                    color: '#8B5CF6',
                    version: 'v2.0',
                    totalCount: 50,
                    processedCount: 50,
                    pendingCount: 0,
                    candidateCount: 32,
                    customCount: 18,
                    skippedCount: 0,
                    queue: []
                },
                {
                    id: 'business_intelligence',
                    name: '商业情报',
                    icon: '📊',
                    color: '#F59E0B',
                    version: 'v1.0',
                    totalCount: 40,
                    processedCount: 18,
                    pendingCount: 22,
                    candidateCount: 12,
                    customCount: 6,
                    skippedCount: 0,
                    queue: [
                        {
                            id: 'bi-1',
                            question: '竞品A本周发布了“买一赠一”活动，我们该如何应对？',
                            source: '官方题库',
                            issueLabel: '缺策略',
                            agentAnswer: '我们也做买一赠一就可以了。',
                            candidateAnswers: [
                                '建议先拆解竞品目标（清库存/拉新/冲GMV），再选对抗策略：如限定SKU对标、加权益不降价、分渠道差异化，并同步复盘用户反馈。',
                                '优先评估价格战风险：可用“价值包+会员权益”替代直接赠品；对高贡献用户做定向补贴，避免全量亏损。',
                                '建议快速拉齐数据：活动时长、覆盖SKU、投放渠道与转化变化；以“限量+差异化卖点”进行反制，并保持毛利底线。'
                            ]
                        },
                        {
                            id: 'bi-2',
                            question: '预测下个月行业需求走势，并给出依据。',
                            source: '用户点踩',
                            issueLabel: '知识缺口',
                            isKnowledgeGap: true,
                            agentAnswer: '下个月需求会增加，因为大家更需要这个产品。',
                            candidateAnswers: [
                                '（示例）需要行业数据支撑，当前知识库缺少相关资料，无法给出可信预测。',
                                '（示例）建议补充：近12个月销量、搜索指数、竞品投放与宏观指标。',
                                '（示例）补全数据后再给出“基准/乐观/悲观”三情景预测。'
                            ]
                        },
                        {
                            id: 'bi-3',
                            question: '我们在新城市落地门店，最可能的3类风险是什么？',
                            source: '自建题库',
                            issueLabel: '缺覆盖',
                            agentAnswer: '可能会有很多风险。',
                            candidateAnswers: [
                                '1) 选址与客流误判；2) 合规与许可；3) 供应链与人力成本。建议分别设置“前置验证指标+止损阈值”。',
                                '风险：租金/装修超预算、招工与培训周期、同商圈竞品反制。建议先做小店试点与滚动复盘。',
                                '风险：客群定位偏差、履约能力不足、渠道协同不顺。建议建立周度运营看板与应急预案。'
                            ]
                        }
                    ]
                }
            ];

            const state = {
                openAbilityId: null,
                activeModalId: null,
                tuning: {
                    abilityId: null,
                    questionId: null
                },
                evolve: {
                    abilityId: null
                },
                isAnimating: false
            };

            const dom = {
                accordion: () => document.getElementById('abilityAccordion'),
                overlay: () => document.getElementById('modalOverlay'),
                toast: () => document.getElementById('toast')
            };

            function clamp(n, min, max) {
                return Math.min(max, Math.max(min, n));
            }

            function getAbility(abilityId) {
                return abilities.find(a => a.id === abilityId);
            }

            function computeProgress(ability) {
                if (!ability.totalCount) return 0;
                return clamp(Math.round((ability.processedCount / ability.totalCount) * 100), 0, 100);
            }

            function isEvolvable(ability) {
                return computeProgress(ability) >= 100 && ability.processedCount > 0;
            }

            function buildCardHtml(ability) {
                const progress = computeProgress(ability);
                const statusText = ability.pendingCount === 0
                    ? (isEvolvable(ability) ? '可进化！' : '暂无待调优题目')
                    : `待处理: ${ability.pendingCount}`;
                const dotClass = isEvolvable(ability) ? 'status-dot evolvable' : 'status-dot';
                const extra = ability.pendingCount === 0 && isEvolvable(ability) ? '' : '';
                return `
                    <div class="ability-card" data-ability-id="${ability.id}" style="--ability-color:${ability.color};--ability-color-bg:${hexToRgba(ability.color, 0.08)};">
                        <div class="ability-header" tabindex="0" role="button" aria-expanded="false" data-action="toggle-ability">
                            <div>
                                <div class="ability-title">
                                    <div class="ability-icon">${escapeHtml(ability.icon)}</div>
                                    <div style="min-width:0;">
                                        <div class="ability-name-row">
                                            <div class="ability-name">${escapeHtml(ability.name)}</div>
                                            <span class="version-badge" data-role="version-badge">
                                                <span class="version-clip">
                                                    <span class="version-stack" data-role="version-stack">
                                                        <span class="version-item" data-role="version-current">${escapeHtml(ability.version)}</span>
                                                        <span class="version-item" data-role="version-next">${escapeHtml(nextVersion(ability.version))}</span>
                                                    </span>
                                                </span>
                                            </span>
                                        </div>
                                        <div class="ability-sub">
                                            <div class="progress">
                                                <div class="progress-track"><div class="progress-fill" data-role="progress-fill" style="width:${progress}%;"></div></div>
                                                <div class="progress-meta">
                                                    <span class="${dotClass}"></span>
                                                    <span data-role="progress-text">${progress}%</span>
                                                    <span>·</span>
                                                    <span data-role="status-text">${escapeHtml(statusText)}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="ability-actions">
                                <button class="toggle-pill" type="button" data-action="toggle-ability">
                                    <span data-role="toggle-text">展开</span> <span class="chev">▾</span>
                                </button>
                            </div>
                        </div>

                        <div class="ability-details" data-role="details">
                            <div class="ability-details-inner">
                                <div class="detail-row">
                                    <div class="detail-title">📋 待调优队列</div>
                                    <div class="detail-sub" data-role="detail-sub">${detailSubText(ability)}</div>
                                </div>
                                <div class="queue" data-role="queue">
                                    ${buildQueueHtml(ability)}
                                </div>
                                <div class="evolve-bar">
                                    <button class="btn btn-small btn-secondary" data-action="tune-next" ${ability.pendingCount > 0 ? '' : 'disabled'}>继续调优</button>
                                    <button class="btn btn-small evolve-cta" data-action="open-evolve" ${isEvolvable(ability) ? '' : 'disabled'}>进化发布</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            function buildQueueHtml(ability) {
                const items = ability.queue.slice(0, 6);
                const remain = Math.max(0, ability.pendingCount - items.length);

                if (ability.pendingCount === 0) {
                    if (isEvolvable(ability)) {
                        return `
                            <div class="empty-queue">
                                <div class="empty-emoji">✅</div>
                                <div>
                                    <div style="font-weight:800; color:var(--eva-text-primary);">已完成本轮调优</div>
                                    <div style="margin-top:4px;">可点击「进化发布」升级版本并重置进度。</div>
                                </div>
                            </div>
                        `;
                    }

                    return `
                        <div class="empty-queue">
                            <div class="empty-emoji">📭</div>
                            <div>
                                <div style="font-weight:800; color:var(--eva-text-primary);">暂无待调优题目</div>
                                <div style="margin-top:4px;">当前能力表现良好，可去题库运行评测发现新的改进点。</div>
                            </div>
                        </div>
                    `;
                }

                const listHtml = items.map((q, idx) => {
                    const isGap = Boolean(q.isKnowledgeGap) || q.issueLabel === '知识缺口';
                    return `
                        <div class="queue-item" data-question-id="${q.id}">
                            <div>
                                <div class="queue-q">${escapeHtml(`${idx + 1}. ${q.question}`)}</div>
                                <div class="queue-meta">
                                    <span class="source-pill">来源：${escapeHtml(q.source)}</span>
                                    <span class="issue-pill ${isGap ? 'gap' : ''}">问题标签：${escapeHtml(q.issueLabel)}</span>
                                </div>
                            </div>
                            <div class="queue-actions">
                                <button class="btn btn-small btn-ability" data-action="start-tune">开始调优</button>
                            </div>
                        </div>
                    `;
                }).join('');

                const moreHtml = remain > 0
                    ? `<div class="detail-sub">… 还有 ${remain} 题（未展开）</div>`
                    : '';

                return listHtml + moreHtml;
            }

            function detailSubText(ability) {
                if (!ability.totalCount) return '已处理 0 / 待处理 0';
                return `已处理 ${ability.processedCount} / 待处理 ${ability.totalCount}`;
            }

            function renderAccordion() {
                dom.accordion().innerHTML = abilities.map(buildCardHtml).join('');
            }

            function setDetailsOpen(cardEl, open) {
                const details = cardEl.querySelector('[data-role="details"]');
                const header = cardEl.querySelector('.ability-header');
                const toggleText = cardEl.querySelector('[data-role="toggle-text"]');
                const isOpen = cardEl.classList.contains('is-open');
                if (open === isOpen) return;

                if (open) {
                    cardEl.classList.add('is-open');
                    header.setAttribute('aria-expanded', 'true');
                    if (toggleText) toggleText.textContent = '收起';
                    details.style.height = details.scrollHeight + 'px';
                    requestAnimationFrame(() => {
                        details.style.height = details.scrollHeight + 'px';
                    });
                } else {
                    cardEl.classList.remove('is-open');
                    header.setAttribute('aria-expanded', 'false');
                    if (toggleText) toggleText.textContent = '展开';
                    details.style.height = details.scrollHeight + 'px';
                    requestAnimationFrame(() => {
                        details.style.height = '0px';
                    });
                }
            }

            function closeAllExcept(keepAbilityId) {
                document.querySelectorAll('.ability-card.is-open').forEach(card => {
                    if (card.getAttribute('data-ability-id') !== keepAbilityId) {
                        setDetailsOpen(card, false);
                    }
                });
            }

            function updateAbilityCard(abilityId) {
                const ability = getAbility(abilityId);
                const card = document.querySelector(`.ability-card[data-ability-id="${abilityId}"]`);
                if (!ability || !card) return;

                const progress = computeProgress(ability);
                const statusTextEl = card.querySelector('[data-role="status-text"]');
                const progressTextEl = card.querySelector('[data-role="progress-text"]');
                const fillEl = card.querySelector('[data-role="progress-fill"]');
                const detailSubEl = card.querySelector('[data-role="detail-sub"]');
                const queueEl = card.querySelector('[data-role="queue"]');
                const versionCurrentEl = card.querySelector('[data-role="version-current"]');
                const versionNextEl = card.querySelector('[data-role="version-next"]');
                const evolveBtn = card.querySelector('[data-action="open-evolve"]');
                const tuneNextBtn = card.querySelector('[data-action="tune-next"]');
                const dot = card.querySelector('.progress-meta .status-dot');

                if (fillEl) fillEl.style.width = `${progress}%`;
                if (progressTextEl) progressTextEl.textContent = `${progress}%`;
                if (detailSubEl) detailSubEl.textContent = detailSubText(ability);
                if (queueEl) queueEl.innerHTML = buildQueueHtml(ability);
                if (versionCurrentEl) versionCurrentEl.textContent = ability.version;
                if (versionNextEl) versionNextEl.textContent = nextVersion(ability.version);
                if (tuneNextBtn) tuneNextBtn.disabled = !(ability.pendingCount > 0);

                const statusText = ability.pendingCount === 0
                    ? (isEvolvable(ability) ? '可进化！' : '暂无待调优题目')
                    : `待处理: ${ability.pendingCount}`;
                if (statusTextEl) statusTextEl.textContent = statusText;
                if (evolveBtn) evolveBtn.disabled = !isEvolvable(ability);

                if (dot) {
                    if (isEvolvable(ability)) dot.classList.add('evolvable');
                    else dot.classList.remove('evolvable');
                }

                if (card.classList.contains('is-open')) {
                    const details = card.querySelector('[data-role="details"]');
                    details.style.height = 'auto';
                    const h = details.scrollHeight;
                    details.style.height = h + 'px';
                }
            }

            function toast(message) {
                const el = dom.toast();
                el.textContent = message;
                el.classList.add('active');
                clearTimeout(el._t);
                el._t = setTimeout(() => el.classList.remove('active'), 2200);
            }

            function openModal(modalId) {
                state.activeModalId = modalId;
                const overlay = dom.overlay();
                overlay.classList.add('active');
                overlay.setAttribute('aria-hidden', 'false');
                ['modalTune', 'modalEvolveConfirm', 'modalEvolveSuccess', 'modalKnowledgeGap'].forEach(id => {
                    const el = document.getElementById(id);
                    if (!el) return;
                    el.style.display = id === modalId ? 'block' : 'none';
                });
            }

            function closeModal() {
                state.activeModalId = null;
                const overlay = dom.overlay();
                overlay.classList.remove('active');
                overlay.setAttribute('aria-hidden', 'true');
                ['modalTune', 'modalEvolveConfirm', 'modalEvolveSuccess', 'modalKnowledgeGap'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.style.display = 'none';
                });
            }

            function openTuningModal(abilityId, questionId) {
                const ability = getAbility(abilityId);
                if (!ability) return;
                const q = ability.queue.find(x => x.id === questionId);
                if (!q) return;

                if (q.isKnowledgeGap || q.issueLabel === '知识缺口') {
                    openModal('modalKnowledgeGap');
                    toast('此题为知识缺口：请先去知识库补充资料');
                    return;
                }

                state.tuning.abilityId = abilityId;
                state.tuning.questionId = questionId;

                document.getElementById('tuneQuestionText').textContent = q.question;
                document.getElementById('tuneAgentAnswer').textContent = q.agentAnswer || '（示例）Agent 原回答';
                const issueTag = document.getElementById('tuneIssueTag');
                issueTag.textContent = q.issueLabel || '待标注';
                issueTag.classList.remove('tag-error');
                issueTag.classList.add('tag-warning');

                const idx = Math.max(0, ability.queue.findIndex(x => x.id === questionId));
                const counter = document.getElementById('tuneCounter');
                counter.querySelector('.chip').textContent = `${idx + 1}/${ability.totalCount || (ability.processedCount + ability.pendingCount || 50)}`;

                const candidates = (q.candidateAnswers || []).slice(0, 3);
                const candWrap = document.getElementById('tuneCandidates');
                candWrap.innerHTML = candidates.map((text, i) => `
                    <div class="radio-card" data-action="select-candidate" data-candidate-index="${i}">
                        <div class="radio-top">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <span class="radio-dot"></span>
                                <div style="font-weight:800; color:var(--eva-text-primary);">候选答案 ${String.fromCharCode(65 + i)}</div>
                            </div>
                            <span class="tag tag-primary">推荐</span>
                        </div>
                        <div style="font-size:13px; color:var(--eva-text-secondary); line-height:1.65;">${escapeHtml(text)}</div>
                    </div>
                `).join('');

                document.getElementById('tuneCustomAnswer').value = '';
                candWrap.dataset.selectedIndex = '';

                openModal('modalTune');
            }

            function selectCandidate(index) {
                const wrap = document.getElementById('tuneCandidates');
                wrap.dataset.selectedIndex = String(index);
                wrap.querySelectorAll('.radio-card').forEach(el => el.classList.remove('selected'));
                const selected = wrap.querySelector(`.radio-card[data-candidate-index="${index}"]`);
                if (selected) selected.classList.add('selected');
                document.getElementById('tuneCustomAnswer').value = '';
            }

            function submitTuning() {
                const ability = getAbility(state.tuning.abilityId);
                if (!ability) return;
                const qid = state.tuning.questionId;
                const qIndex = ability.queue.findIndex(x => x.id === qid);
                if (qIndex < 0) return;

                const selectedIndex = document.getElementById('tuneCandidates').dataset.selectedIndex;
                const custom = document.getElementById('tuneCustomAnswer').value.trim();
                if (custom.length === 0 && (selectedIndex === '' || selectedIndex == null)) {
                    toast('请选择候选答案或填写自行作答');
                    return;
                }

                if (custom.length > 0) ability.customCount += 1;
                else ability.candidateCount += 1;

                ability.processedCount += 1;
                ability.pendingCount = Math.max(0, ability.pendingCount - 1);
                ability.queue.splice(qIndex, 1);

                updateAbilityCard(ability.id);
                closeModal();
                toast(`已提交：${ability.name} 进度 ${computeProgress(ability)}%`);
            }

            function skipTuning() {
                const ability = getAbility(state.tuning.abilityId);
                if (!ability) return;
                const qid = state.tuning.questionId;
                const qIndex = ability.queue.findIndex(x => x.id === qid);
                if (qIndex < 0) return;

                ability.skippedCount += 1;
                const [q] = ability.queue.splice(qIndex, 1);
                ability.queue.push(q);

                updateAbilityCard(ability.id);
                closeModal();
                toast('已跳过：题目保留在队列中');
            }

            function openEvolveConfirm(abilityId) {
                const ability = getAbility(abilityId);
                if (!ability) return;
                if (!isEvolvable(ability)) {
                    toast('进度未满或尚未完成调优，无法进化');
                    return;
                }

                state.evolve.abilityId = abilityId;
                const next = nextVersion(ability.version);

                document.getElementById('evolveConfirmIntro').innerHTML = `即将将「<b>${escapeHtml(ability.name)}</b>」能力升级至 <b>${escapeHtml(next)}</b>。`;
                document.getElementById('evolveConfirmSummary').innerHTML = [
                    `├── 调优题目数：${ability.totalCount} 题`,
                    `├── 选择候选答案：${ability.candidateCount} 题`,
                    `├── 自行作答：${ability.customCount} 题`,
                    `└── 跳过：${ability.skippedCount} 题`
                ].join('<br />');
                document.getElementById('evolveConfirmVersionLine').textContent = `版本号：${ability.version} → ${next}`;

                openModal('modalEvolveConfirm');
            }

            function createSparkles(cardEl) {
                const existing = cardEl.querySelector('.sparkles');
                if (existing) existing.remove();
                const wrap = document.createElement('div');
                wrap.className = 'sparkles';
                const count = 10;
                for (let i = 0; i < count; i++) {
                    const s = document.createElement('div');
                    s.className = 'sparkle';
                    s.style.left = (10 + Math.random() * 80).toFixed(1) + '%';
                    s.style.top = (18 + Math.random() * 64).toFixed(1) + '%';
                    s.style.animationDelay = (Math.random() * 320).toFixed(0) + 'ms';
                    wrap.appendChild(s);
                }
                cardEl.appendChild(wrap);
                setTimeout(() => wrap.remove(), 1100);
            }

            function rollVersion(cardEl, newVersion) {
                const badge = cardEl.querySelector('[data-role="version-badge"]');
                const currentEl = cardEl.querySelector('[data-role="version-current"]');
                const nextEl = cardEl.querySelector('[data-role="version-next"]');
                if (!badge || !currentEl || !nextEl) return;

                nextEl.textContent = newVersion;
                badge.classList.add('rolling');
                setTimeout(() => {
                    currentEl.textContent = newVersion;
                    nextEl.textContent = nextVersion(newVersion);
                    badge.classList.remove('rolling');
                }, 940);
            }

            async function confirmEvolve() {
                const ability = getAbility(state.evolve.abilityId);
                if (!ability) return;
                const card = document.querySelector(`.ability-card[data-ability-id="${ability.id}"]`);
                if (!card) return;
                if (state.isAnimating) return;

                closeModal();
                state.isAnimating = true;
                card.classList.add('is-evolving');
                createSparkles(card);

                const oldVersion = ability.version;
                const newVersion = nextVersion(oldVersion);
                rollVersion(card, newVersion);

                const progressFill = card.querySelector('[data-role="progress-fill"]');
                const progressText = card.querySelector('[data-role="progress-text"]');
                const statusText = card.querySelector('[data-role="status-text"]');
                if (statusText) statusText.textContent = '进化中…';
                if (progressText) progressText.textContent = '100%';
                if (progressFill) progressFill.style.width = '100%';

                await wait(1050);
                if (progressFill) progressFill.style.width = '0%';
                if (progressText) progressText.textContent = '0%';

                await wait(1450);

                ability.version = newVersion;
                ability.totalCount = 0;
                ability.processedCount = 0;
                ability.pendingCount = 0;
                ability.candidateCount = 0;
                ability.customCount = 0;
                ability.skippedCount = 0;
                ability.queue = [];

                updateAbilityCard(ability.id);
                card.classList.remove('is-evolving');
                state.isAnimating = false;

                document.getElementById('evolveSuccessDesc').innerHTML = `「<b>${escapeHtml(ability.name)}</b>」已升级至 <b>${escapeHtml(newVersion)}</b><br />Agent 正在学习新内容，即将生效。`;
                openModal('modalEvolveSuccess');
            }

            function tuneNext(abilityId) {
                const ability = getAbility(abilityId);
                if (!ability) return;
                if (ability.pendingCount <= 0) {
                    toast('暂无可调优题目');
                    return;
                }
                const q = ability.queue[0];
                if (!q) {
                    toast('队列示例不足（仍有未展开题目）');
                    return;
                }
                openTuningModal(ability.id, q.id);
            }

            function wait(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            function parseVersion(v) {
                const m = String(v || '').match(/^v(\d+)(?:\.(\d+))?$/i);
                if (!m) return { major: 1, minor: 0 };
                return { major: Number(m[1] || 1), minor: Number(m[2] || 0) };
            }

            function nextVersion(v) {
                const { major } = parseVersion(v);
                return `v${major + 1}.0`;
            }

            function hexToRgba(hex, alpha) {
                const h = String(hex || '').replace('#', '').trim();
                if (h.length !== 6) return `rgba(99,102,241,${alpha})`;
                const r = parseInt(h.slice(0, 2), 16);
                const g = parseInt(h.slice(2, 4), 16);
                const b = parseInt(h.slice(4, 6), 16);
                return `rgba(${r},${g},${b},${alpha})`;
            }

            function escapeHtml(str) {
                return String(str ?? '').replace(/[&<>"']/g, s => ({
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;'
                }[s]));
            }

            function bindEvents() {
                document.addEventListener('click', (e) => {
                    const actionEl = e.target.closest('[data-action]');
                    if (!actionEl) return;
                    const action = actionEl.getAttribute('data-action');
                    const card = e.target.closest('.ability-card');
                    const abilityId = card ? card.getAttribute('data-ability-id') : null;

                    if (action === 'toggle-ability') {
                        if (!abilityId || state.isAnimating) return;
                        const cardEl = document.querySelector(`.ability-card[data-ability-id="${abilityId}"]`);
                        const willOpen = !cardEl.classList.contains('is-open');
                        closeAllExcept(willOpen ? abilityId : null);
                        setDetailsOpen(cardEl, willOpen);
                        return;
                    }

                    if (action === 'start-tune') {
                        if (!abilityId || state.isAnimating) return;
                        const qEl = e.target.closest('[data-question-id]');
                        if (!qEl) return;
                        const qid = qEl.getAttribute('data-question-id');
                        openTuningModal(abilityId, qid);
                        return;
                    }

                    if (action === 'tune-next') {
                        if (!abilityId || state.isAnimating) return;
                        tuneNext(abilityId);
                        return;
                    }

                    if (action === 'open-evolve') {
                        if (!abilityId || state.isAnimating) return;
                        openEvolveConfirm(abilityId);
                        return;
                    }

                    if (action === 'close-modal') {
                        closeModal();
                        return;
                    }

                    if (action === 'cancel-evolve') {
                        closeModal();
                        return;
                    }

                    if (action === 'confirm-evolve') {
                        confirmEvolve();
                        return;
                    }

                    if (action === 'select-candidate') {
                        const idx = Number(actionEl.getAttribute('data-candidate-index') || '0');
                        selectCandidate(idx);
                        return;
                    }

                    if (action === 'submit-tune') {
                        submitTuning();
                        return;
                    }

                    if (action === 'skip-tune') {
                        skipTuning();
                        return;
                    }

                    if (action === 'go-knowledge') {
                        closeModal();
                        toast('（原型）跳转到知识库：请在侧边栏进入「知识库」');
                        return;
                    }
                });

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && state.activeModalId) closeModal();
                });

                dom.overlay().addEventListener('click', (e) => {
                    if (e.target === dom.overlay()) closeModal();
                });

                document.getElementById('tuneCustomAnswer').addEventListener('input', () => {
                    const wrap = document.getElementById('tuneCandidates');
                    wrap.dataset.selectedIndex = '';
                    wrap.querySelectorAll('.radio-card').forEach(el => el.classList.remove('selected'));
                });
            }

            function init() {
                renderAccordion();
                bindEvents();
            }

            return { init };
        })();

        function copyPrototypeHtml() {
            const html = document.documentElement.outerHTML;
            const success = () => {
                const el = document.getElementById('toast');
                el.textContent = '已复制当前HTML到剪贴板';
                el.classList.add('active');
                clearTimeout(el._t);
                el._t = setTimeout(() => el.classList.remove('active'), 2200);
            };

            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(html).then(success).catch(() => fallbackCopy(html, success));
                return;
            }
            fallbackCopy(html, success);
        }

        function fallbackCopy(text, onDone) {
            const ta = document.createElement('textarea');
            ta.value = text;
            ta.setAttribute('readonly', 'true');
            ta.style.position = 'fixed';
            ta.style.left = '-9999px';
            ta.style.top = '0';
            document.body.appendChild(ta);
            ta.select();
            try {
                document.execCommand('copy');
                onDone();
            } catch (e) {
                alert('复制失败：请手动复制页面源码（右键→查看网页源代码）');
            } finally {
                ta.remove();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            AgentEvolution.init();
        });
    </script>

    <!-- ========== @FROZEN: 核心JavaScript ========== -->
    <script>
        // ========== 模式切换 ==========
        let currentMode = 'interactive';

        function switchMode(mode) {
            currentMode = mode;
            const container = document.getElementById('artboardContainer');
            const buttons = document.querySelectorAll('.mode-btn');

            buttons.forEach((btn, index) => {
                btn.classList.remove('active');
                if ((mode === 'interactive' && index === 0) ||
                    (mode === 'artboard' && index === 1)) {
                    btn.classList.add('active');
                }
            });

            if (mode === 'artboard') {
                document.body.classList.add('artboard-mode');
                container.classList.add('active');
                initArtboardContent();
            } else {
                document.body.classList.remove('artboard-mode');
                container.classList.remove('active');
            }
        }

        // ========== 画板内容初始化（克隆机制） ==========
        function initArtboardContent() {
            // 克隆主内容到页面预览画板
            const mainContent = document.getElementById('mainContent');
            const pagePreview = document.querySelector('#artboard-1 .artboard-page-preview');

            if (mainContent && pagePreview && !pagePreview.hasChildNodes()) {
                const clone = mainContent.cloneNode(true);
                clone.style.cssText = 'pointer-events: none; user-select: none;';
                pagePreview.appendChild(clone);
            }

            // TODO: 根据需要初始化其他画板的内容
        }

        // ========== 单个画板截图 ==========
        async function captureArtboard(artboardId, filename) {
            const artboard = document.getElementById(artboardId);
            if (!artboard) {
                console.error('Artboard not found:', artboardId);
                return;
            }

            // 检查是否加载了html2canvas
            if (typeof html2canvas === 'undefined') {
                alert('截图功能需要html2canvas库。\n请添加：<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"><\/script>');
                return;
            }

            try {
                const canvas = await html2canvas(artboard, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff'
                });

                const link = document.createElement('a');
                link.download = filename + '.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            } catch (error) {
                console.error('截图失败:', error);
                alert('截图失败，请查看控制台了解详情');
            }
        }

        // ========== 批量导出 ==========
        async function batchExport() {
            const artboards = document.querySelectorAll('.artboard');

            if (typeof html2canvas === 'undefined') {
                alert('批量导出需要html2canvas库。');
                return;
            }

            for (let i = 0; i < artboards.length; i++) {
                const artboard = artboards[i];
                const label = artboard.querySelector('.artboard-label span:first-child');
                const filename = String(i + 1).padStart(2, '0') + '-' +
                    (label ? label.textContent.replace(/\s+/g, '-') : 'artboard-' + (i + 1));

                await captureArtboard(artboard.id, filename);

                // 延迟以避免浏览器过载
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            alert('批量导出完成！');
        }

        // ========== 打印导出PDF ==========
        function printArtboards() {
            // 先切换到画板模式
            switchMode('artboard');

            // 延迟后打印
            setTimeout(() => {
                window.print();
            }, 300);
        }

        // ========== 页面加载完成 ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('EVA Prototype Template loaded successfully');

            // 检查URL参数，支持直接打开画板模式
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('mode') === 'artboard') {
                switchMode('artboard');
            }
        });
    </script>
    <!-- ========== @END-FROZEN: 核心JavaScript ========== -->

    <!-- 可选：html2canvas库（用于截图功能） -->
    <!-- <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script> -->
</body>
</html>

